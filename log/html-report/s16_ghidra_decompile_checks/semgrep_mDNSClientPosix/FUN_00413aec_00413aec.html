<!-- 
EMBA - EMBEDDED LINUX ANALYZER

Copyright 2020-2023 Siemens AG
Copyright 2020-2024 Siemens Energy AG

EMBA comes with ABSOLUTELY NO WARRANTY. This is free software, and you are
welcome to redistribute it under the terms of the GNU General Public License.
See LICENSE file for usage of this software.

EMBA is licensed under GPLv3

Author(s) and contributors from the EMBA project are listed here: https://github.com/e-m-b-a/emba/blob/master/CONTRIBUTORS.md
-->

<!-- Used icons: https://github.com/CoreyGinnivan/system-uicons -->
 
<!DOCTYPE html>
<html lang="en">
<head>
  <title>EMBA firmware report</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="./../../style/style.css" type="text/css">
  <link rel="icon" type="image/png" href="./../../style/favicon.png">
</head>
<body>

<div id="sidenav" class="side">
  <div id="logo">
    <a class="inherit" href="./../../index.html"><img class="inherit" id="logoImage" src="./../../style/emba.svg" alt="logo"></a>
  </div>
  <div id="nav">
      <a id="embark" class="hidden" href="{{ embarkBackUrl }}">&laquo; Back to EMBArk</a> <!-- nosem -->
      <a class="backButton" href="./../../index.html">&laquo; Back to main</a>
<a class="modul" href="./../semgrep_mDNSClientPosix.html" title="./../semgrep_mDNSClientPosix.html" >&laquo; Back to semgrep_mDNSClientPosix</a>
      <!-- navigation start -->
      <!-- navigation end -->
      <input id="expand" class="expand_njs hidden" type="button" value="More results:" onclick="this.value=this.value=='+ Show more results'?'- Hide more results':'+ Show more results';">
      <div class="expand_area">
        <!-- etc start -->
        <!-- etc end -->
      </div>
  </div>
  <a href="TIMELINK"><div id="buttonTimeInvisible" class="rectButton"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="40" height="40" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 21 21"><g fill="none" fill-rule="evenodd" stroke="white" stroke-linecap="round" stroke-linejoin="round" transform="matrix(-1 0 0 1 19 2)"><circle cx="8.5" cy="8.5" r="8"/><path d="M8.5 5.5v4H5"/></g></svg></div></a>
  <div id="buttonSizer" class="rectButton buttonClose" onclick="buttonNav()"></div>
</div>
<div id="main" class="main">
  <!-- content start -->
<br />
<pre>/* WARNING: Removing unreachable block (ram,0x00414208) */</pre>
<br />
<pre>void FUN_00413aec(uint *param_1,int *param_2,char param_3,int param_4)</pre>
<br />
<pre>{</pre>
<pre>  ushort uVar1;</pre>
<pre>  bool bVar2;</pre>
<pre>  ushort *puVar3;</pre>
<pre>  uint uVar4;</pre>
<pre>  void *pvVar5;</pre>
<pre>  undefined4 uVar6;</pre>
<pre>  char *pcVar7;</pre>
<pre>  int iVar8;</pre>
<pre>  int iVar9;</pre>
<pre>  int iVar10;</pre>
<pre>  int **ppiVar11;</pre>
<pre>  int iVar12;</pre>
<pre>  int *piVar13;</pre>
<pre>  int *piVar14;</pre>
<pre>  ushort uVar15;</pre>
<pre>  uint uVar16;</pre>
<pre>  int *in_stack_ffffff88;</pre>
<pre>  uint in_stack_ffffff90;</pre>
<pre>  char local_58 [4];</pre>
<pre>  undefined2 local_54;</pre>
<pre>  undefined2 local_52;</pre>
<pre>  undefined2 local_50;</pre>
<pre>  undefined4 local_4c;</pre>
<pre>  undefined4 local_48;</pre>
<pre>  undefined4 local_44;</pre>
<pre>  undefined auStack_40 [24];</pre>
<pre>  </pre>
<pre>  local_58[0] = '\0';</pre>
<pre>  iVar9 = param_2[0x8c1];</pre>
<pre>  iVar10 = *param_2;</pre>
<pre>  ppiVar11 = (int **)(iVar9 + 0x10c);</pre>
<pre>  if ((iVar9 == 0) &amp;&amp; (ppiVar11 = (int **)(param_2[0x8c2] + 0x104), param_2[0x8c2] == 0)) {</pre>
<pre>    ppiVar11 = (int **)0x0;</pre>
<pre>  }</pre>
<pre>  else if (*ppiVar11 != param_2) {</pre>
<pre>    uVar6 = mDNSPlatformTCPGetFD(param_2[1]);</pre>
<pre>    in_stack_ffffff90 = param_2[0x8c2];</pre>
<pre>    in_stack_ffffff88 = param_2;</pre>
<pre>    LogMsgWithLevel(0,"tcpCallback: %d backpointer %p incorrect tcpInfo %p question %p rr %p",uVar6,</pre>
<pre>                    *ppiVar11,param_2,iVar9,in_stack_ffffff90);</pre>
<pre>  }</pre>
<pre>  if (param_4 == 0) {</pre>
<pre>    if (param_3 == '\0') {</pre>
<pre>      uVar4 = param_2[0x8cb];</pre>
<pre>      bVar2 = uVar4 &lt; 2;</pre>
<pre>      if (bVar2) {</pre>
<pre>        iVar8 = mDNSPlatformReadTCP(param_1,(int)param_2 + uVar4 + 9000,2 - uVar4,local_58);</pre>
<pre>        if (-1 &lt; iVar8) {</pre>
<pre>          if (local_58[0] != '\0') goto LAB_0041405c;</pre>
<pre>          iVar12 = param_2[0x8cb];</pre>
<pre>          param_2[0x8cb] = iVar8 + iVar12;</pre>
<pre>          if ((uint)(iVar8 + iVar12) &lt; 2) {</pre>
<pre>            return;</pre>
<pre>          }</pre>
<pre>          uVar4 = (uint)*(ushort *)(param_2 + 0x8ca);</pre>
<pre>          *(ushort *)(param_2 + 0x8ca) = *(ushort *)(param_2 + 0x8ca);</pre>
<pre>          if (0xb &lt; uVar4) {</pre>
<pre>            pvVar5 = mDNSPlatformMemAllocate(uVar4);</pre>
<pre>            param_2[0x8c9] = (int)pvVar5;</pre>
<pre>            if (pvVar5 == (void *)0x0) {</pre>
<pre>              LogMsgWithLevel(0,"ERROR: tcpCallback - malloc failed");</pre>
<pre>              param_4 = -0x10003;</pre>
<pre>              goto LAB_0041419c;</pre>
<pre>            }</pre>
<pre>            uVar4 = param_2[0x8cb];</pre>
<pre>            goto LAB_00414008;</pre>
<pre>          }</pre>
<pre>          LogMsgWithLevel(0,"ERROR: tcpCallback - length too short (%d bytes)",uVar4);</pre>
<pre>          goto LAB_00414198;</pre>
<pre>        }</pre>
<pre>        pcVar7 = "ERROR: tcpCallback - attempt to read message length failed (%d)";</pre>
<pre>      }</pre>
<pre>      else {</pre>
<pre>LAB_00414008:</pre>
<pre>        iVar8 = mDNSPlatformReadTCP(param_1,param_2[0x8c9] + (uVar4 - 2),</pre>
<pre>                                    (*(ushort *)(param_2 + 0x8ca) - uVar4) + 2,local_58);</pre>
<pre>        if (iVar8 &lt; 0) {</pre>
<pre>          if (bVar2) {</pre>
<pre>            return;</pre>
<pre>          }</pre>
<pre>          pcVar7 = "ERROR: tcpCallback - read returned %d";</pre>
<pre>        }</pre>
<pre>        else {</pre>
<pre>          if (local_58[0] == '\0') {</pre>
<pre>            uVar4 = (iVar8 + param_2[0x8cb]) - 2;</pre>
<pre>            param_2[0x8cb] = iVar8 + param_2[0x8cb];</pre>
<pre>            if (uVar4 != *(ushort *)(param_2 + 0x8ca)) {</pre>
<pre>              return;</pre>
<pre>            }</pre>
<pre>            pvVar5 = (void *)param_2[0x8c9];</pre>
<pre><span class="green"><span class="green">            memcpy(auStack_40,param_2 + 0x8c3,0x14)</span></span></span></pre>
<pre>            param_2[0x8cc] = param_2[0x8cc] + 1;</pre>
<pre>            param_2[0x8c9] = 0;</pre>
<pre>            param_2[0x8cb] = 0;</pre>
<pre>            *(undefined2 *)(param_2 + 0x8ca) = 0;</pre>
<pre>            uVar16 = *param_1;</pre>
<pre>            uVar15 = 0;</pre>
<pre>            uVar1 = *(ushort *)(param_2 + 0x8c8);</pre>
<pre>            if ((iVar9 != 0) &amp;&amp; (*(int *)(iVar9 + 0x10c) != 0)) {</pre>
<pre>              uVar15 = *(ushort *)(*(int *)(iVar9 + 0x10c) + 0x2322);</pre>
<pre>              *(ushort *)(iVar9 + 0x110) = uVar15;</pre>
<pre>            }</pre>
<pre>            if ((ppiVar11 != (int **)0x0) &amp;&amp;</pre>
<pre>               (((iVar9 == 0 || (*(char *)(iVar9 + 600) == '\0')) ||</pre>
<pre>                (*(char *)(iVar10 + 0x275) != '\0')))) {</pre>
<pre>              *ppiVar11 = (int *)0x0;</pre>
<pre>              DisposeTCPConn(param_2);</pre>
<pre>            }</pre>
<pre>            mDNSCoreReceive(iVar10,pvVar5,(int)pvVar5 + uVar4,auStack_40,</pre>
<pre>                            (uint)in_stack_ffffff88 &amp; 0xffff | (uint)uVar1 &lt;&lt; 0x10,uVar16 &amp; 1,</pre>
<pre>                            in_stack_ffffff90 &amp; 0xffff | (uint)uVar15 &lt;&lt; 0x10,0);</pre>
<pre>            mDNSPlatformMemFree(pvVar5);</pre>
<pre>            return;</pre>
<pre>          }</pre>
<pre>LAB_0041405c:</pre>
<pre>          if (param_2[0x8cc] != 0) {</pre>
<pre>            if (ppiVar11 != (int **)0x0) {</pre>
<pre>              *ppiVar11 = (int *)0x0;</pre>
<pre>            }</pre>
<pre>            goto LAB_00414444;</pre>
<pre>          }</pre>
<pre>          pcVar7 = "ERROR: socket closed prematurely tcpInfo-&gt;nread = %d";</pre>
<pre>          iVar8 = param_2[0x8cb];</pre>
<pre>        }</pre>
<pre>      }</pre>
<pre>      LogMsgWithLevel(0,pcVar7,iVar8);</pre>
<pre>      param_4 = -0x100fc;</pre>
<pre>    }</pre>
<pre>    else {</pre>
<pre>      iVar8 = param_2[0x8c2];</pre>
<pre>      iVar12 = param_2[0x8c0];</pre>
<pre>      if ((iVar8 != 0) &amp;&amp; (*(int *)(iVar8 + 0x20) != iVar8 + 0x178)) {</pre>
<pre>        LogMsgWithLevel(0,</pre>
<pre>                        "tcpCallback: ERROR: tcpInfo-&gt;rr-&gt;resrec.name %p != &amp;tcpInfo-&gt;rr-&gt;namestorage %p"</pre>
<pre>                       );</pre>
<pre>      }</pre>
<pre>      iVar8 = param_2[0x8c2];</pre>
<pre>      uVar6 = 0;</pre>
<pre>      if (iVar8 != 0) {</pre>
<pre>        if (*(int *)(iVar8 + 0x20) != iVar8 + 0x178) {</pre>
<pre>          return;</pre>
<pre>        }</pre>
<pre>        uVar6 = FUN_0040d9ac(iVar10);</pre>
<pre>      }</pre>
<pre>      if (iVar9 == 0) {</pre>
<pre>        iVar8 = (int)param_2 + iVar12 + 8;</pre>
<pre>      }</pre>
<pre>      else {</pre>
<pre>        if (*(char *)(iVar9 + 600) == '\0') {</pre>
<pre>LAB_00413d3c:</pre>
<pre>          if (((*(char *)(iVar9 + 0x266) == '\0') &amp;&amp; (*(char *)(iVar9 + 0xcc) == '\0')) &amp;&amp;</pre>
<pre>             ((*(char *)(iVar9 + 0x267) == '\0' || (*(char *)(iVar9 + 0x268) == '\0')))) {</pre>
<pre>            puVar3 = &amp;uQueryFlags;</pre>
<pre>          }</pre>
<pre>          else {</pre>
<pre>            puVar3 = &amp;DNSSecQFlags;</pre>
<pre>          }</pre>
<pre>          piVar14 = param_2 + 2;</pre>
<pre>          piVar13 = param_2 + 0x8c0;</pre>
<pre>          InitializeDNSMessage</pre>
<pre>                    (param_2 + 2,(uint)*(ushort *)(iVar9 + 0x152) &lt;&lt; 0x10,(uint)*puVar3 &lt;&lt; 0x10);</pre>
<pre>          iVar8 = putQuestion(piVar14,param_2 + 5,piVar13,iVar9 + 0x154,</pre>
<pre>                              *(undefined2 *)(iVar9 + 0x254),*(undefined2 *)(iVar9 + 0x256));</pre>
<pre>          if ((((*(char *)(iVar9 + 0x266) != '\0') || (*(char *)(iVar9 + 0xcc) != '\0')) ||</pre>
<pre>              ((*(char *)(iVar9 + 0x267) != '\0' &amp;&amp; (*(char *)(iVar9 + 0x268) != '\0')))) &amp;&amp;</pre>
<pre>             ((*(int *)(iVar9 + 0xdc) != 0 &amp;&amp; (*(char *)(*(int *)(iVar9 + 0xdc) + 0x13c) == '\0'))))</pre>
<pre>          {</pre>
<pre>            if (*(char *)(iVar9 + 0x267) == '\0') {</pre>
<pre>              iVar8 = putDNSSECOption(piVar14,iVar8,piVar13);</pre>
<pre>            }</pre>
<pre>            else {</pre>
<pre>              iVar8 = DNSProxySetAttributes(iVar9,param_2 + 2,piVar14,iVar8,piVar13);</pre>
<pre>            }</pre>
<pre>          }</pre>
<pre>        }</pre>
<pre>        else {</pre>
<pre>          if (*(int *)(iVar9 + 0x114) == 3) {</pre>
<pre>            iVar8 = (int)param_2 + param_2[0x8c0] + 8;</pre>
<pre>            goto LAB_00413e60;</pre>
<pre>          }</pre>
<pre>          if (((*(int *)(iVar9 + 0x114) == 4) || (*(short *)(iVar10 + 0x2998) == 0)) ||</pre>
<pre>             (*(short *)(iVar9 + 0x108) == 0)) goto LAB_00413d3c;</pre>
<pre>          local_52 = 1;</pre>
<pre>          local_54 = 1;</pre>
<pre>          uVar6 = FUN_0040e7b0(iVar10,param_2 + 0x8c3);</pre>
<pre>          local_50 = (undefined2)uVar6;</pre>
<pre>          if (mDNS_LoggingEnabled != 0) {</pre>
<pre>            LogMsgWithLevel(3,"tcpCallback: eventPort %d",uVar6);</pre>
<pre>          }</pre>
<pre>          local_48 = 0;</pre>
<pre>          local_4c = 0;</pre>
<pre>          local_44 = 0x1c20;</pre>
<pre>          InitializeDNSMessage(param_2 + 2,(uint)*(ushort *)(iVar9 + 0x152) &lt;&lt; 0x10,0x1000000);</pre>
<pre>          iVar8 = FUN_0040e3f4(param_2 + 2,param_2 + 5,iVar9,&amp;local_54);</pre>
<pre>          if (iVar8 == 0) {</pre>
<pre>            LogMsgWithLevel(0,"ERROR: tcpCallback - putLLQ");</pre>
<pre>            goto LAB_00414198;</pre>
<pre>          }</pre>
<pre>          *(undefined2 *)(iVar9 + 0x120) = 0;</pre>
<pre>        }</pre>
<pre>        uVar6 = *(undefined4 *)(iVar9 + 0x38);</pre>
<pre>      }</pre>
<pre>LAB_00413e60:</pre>
<pre>      iVar8 = mDNSSendDNSMessage(iVar10,param_2 + 2,iVar8,0,0,param_2 + 0x8c3,</pre>
<pre>                                 in_stack_ffffff90 &amp; 0xffff |</pre>
<pre>                                 (uint)*(ushort *)(param_2 + 0x8c8) &lt;&lt; 0x10,param_1,uVar6,0);</pre>
<pre>      if (iVar8 == 0) {</pre>
<pre>        if (iVar9 == 0) {</pre>
<pre>          return;</pre>
<pre>        }</pre>
<pre>        mDNS_Lock_(iVar10,"tcpCallback");</pre>
<pre>        *(undefined4 *)(iVar9 + 0xc) = *(undefined4 *)(iVar10 + 0x234);</pre>
<pre>        if (*(int *)(iVar9 + 0x10) &lt; mDNSPlatformOneSecond &lt;&lt; 8) {</pre>
<pre>          *(int *)(iVar9 + 0x10) = mDNSPlatformOneSecond &lt;&lt; 8;</pre>
<pre>        }</pre>
<pre>        SetNextQueryTime(iVar10,iVar9);</pre>
<pre>        mDNS_Unlock_(iVar10,"tcpCallback");</pre>
<pre>        return;</pre>
<pre>      }</pre>
<pre>LAB_00414198:</pre>
<pre>      param_4 = -0x10001;</pre>
<pre>    }</pre>
<pre>  }</pre>
<pre>LAB_0041419c:</pre>
<pre>  if (ppiVar11 != (int **)0x0) {</pre>
<pre>    *ppiVar11 = (int *)0x0;</pre>
<pre>  }</pre>
<pre>  mDNS_Lock_(iVar10,"tcpCallback");</pre>
<pre>  if (iVar9 != 0) {</pre>
<pre>    iVar8 = *(int *)(iVar10 + 0x234);</pre>
<pre>    if (*(int *)(iVar9 + 0x10) == 0) {</pre>
<pre>      *(int *)(iVar9 + 0xc) = iVar8;</pre>
<pre>      if (*(char *)(iVar9 + 600) == '\0') {</pre>
<pre>        *(int *)(iVar9 + 0x10) = mDNSPlatformOneSecond * 0xe10;</pre>
<pre>        uVar6 = DNSTypeName(*(undefined2 *)(iVar9 + 0x254));</pre>
<pre>        pcVar7 = "tcpCallback: stream connection for %##s (%s) failed, retrying in %d ms";</pre>
<pre>        iVar8 = *(int *)(iVar9 + 0x10);</pre>
<pre>      }</pre>
<pre>      else {</pre>
<pre>        iVar8 = *(short *)(iVar9 + 0x120) + 1;</pre>
<pre>        *(int *)(iVar9 + 0x10) = (mDNSPlatformOneSecond + 2) / 3;</pre>
<pre>        while( true ) {</pre>
<pre>          if (iVar8 == 0) break;</pre>
<pre>          iVar8 = iVar8 + -1;</pre>
<pre>          *(int *)(iVar9 + 0x10) = *(int *)(iVar9 + 0x10) * 3;</pre>
<pre>        }</pre>
<pre>        if (mDNSPlatformOneSecond * 900 &lt; *(int *)(iVar9 + 0x10)) {</pre>
<pre>          *(int *)(iVar9 + 0x10) = mDNSPlatformOneSecond * 900;</pre>
<pre>        }</pre>
<pre>        else {</pre>
<pre>          *(short *)(iVar9 + 0x120) = *(short *)(iVar9 + 0x120) + 1;</pre>
<pre>        }</pre>
<pre>        uVar6 = DNSTypeName(*(undefined2 *)(iVar9 + 0x254));</pre>
<pre>        iVar8 = (int)*(short *)(iVar9 + 0x120);</pre>
<pre>        pcVar7 = </pre>
<pre>        "tcpCallback: stream connection for LLQ %##s (%s) failed %d times, retrying in %d ms";</pre>
<pre>      }</pre>
<pre>      LogMsgWithLevel(0,pcVar7,iVar9 + 0x154,uVar6,iVar8);</pre>
<pre>      SetNextQueryTime(iVar10,iVar9);</pre>
<pre>    }</pre>
<pre>    else {</pre>
<pre>      if (*(char *)(iVar9 + 600) == '\0') {</pre>
<pre>        iVar12 = 0xe10;</pre>
<pre>      }</pre>
<pre>      else {</pre>
<pre>        iVar12 = 900;</pre>
<pre>      }</pre>
<pre>      if (mDNSPlatformOneSecond * iVar12 &lt; (*(int *)(iVar9 + 0xc) + *(int *)(iVar9 + 0x10)) - iVar8)</pre>
<pre>      {</pre>
<pre>        *(int *)(iVar9 + 0xc) = iVar8;</pre>
<pre>        if (*(char *)(iVar9 + 600) == '\0') {</pre>
<pre>          iVar8 = 0xe10;</pre>
<pre>        }</pre>
<pre>        else {</pre>
<pre>          iVar8 = 900;</pre>
<pre>        }</pre>
<pre>        *(int *)(iVar9 + 0x10) = mDNSPlatformOneSecond * iVar8;</pre>
<pre>        SetNextQueryTime(iVar10,iVar9);</pre>
<pre>        uVar6 = DNSTypeName(*(undefined2 *)(iVar9 + 0x254));</pre>
<pre>        LogMsgWithLevel(0,"tcpCallback: stream connection for %##s (%s) failed, retrying in %d ms",</pre>
<pre>                        iVar9 + 0x154,uVar6,*(undefined4 *)(iVar9 + 0x10));</pre>
<pre>      }</pre>
<pre>    }</pre>
<pre>    if ((*(char *)(iVar9 + 600) != '\0') &amp;&amp; (*(int *)(iVar9 + 0x114) == 2)) {</pre>
<pre>      *(undefined4 *)(iVar9 + 0x114) = 1;</pre>
<pre>    }</pre>
<pre>    if (((param_4 != -0x100fc) &amp;&amp; (*(char *)(iVar9 + 600) != '\0')) &amp;&amp;</pre>
<pre>       (*(int *)(iVar9 + 0x114) != 4)) {</pre>
<pre>      FUN_0040e534(iVar10,iVar9);</pre>
<pre>    }</pre>
<pre>  }</pre>
<pre>  mDNS_Unlock_(iVar10,"tcpCallback");</pre>
<pre>LAB_00414444:</pre>
<pre>  DisposeTCPConn(param_2);</pre>
<pre>  return;</pre>
<pre>}</pre>
<br />
  <!-- content end -->
</div>

<a href="https://github.com/e-m-b-a/emba" title="github.com/e-m-b-a/emba" target="_blank">
  <div id="buttonInfo" class="rectButtonVisible">
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="40" height="40" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 21 21"><g fill="none" fill-rule="evenodd" transform="translate(2 2)"><g stroke="white" stroke-linecap="round" stroke-linejoin="round"><circle cx="8.5" cy="8.5" r="8"/><path d="M8.5 12.5v-4h-1"/><path d="M7.5 12.5h2"/></g><circle cx="8.5" cy="5.5" fill="white" r="1"/></g></svg>
  </div>
</a>
<div id="buttonBack" class="nonClickable rectButtonVisible"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="40" height="40" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 21 21"><path d="M9.5 14.5l4-4l-4-4" fill="none" stroke="#444" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
<div id="buttonForward" class="nonClickable rectButtonVisible"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="40" height="40" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 21 21"><path d="M11.5 14.5l-4-4l4-4" fill="none" stroke="#444" stroke-linecap="round" stroke-linejoin="round"/></svg></div> 
<div id="buttonDown" class="rectButton" onclick="scrollDown()"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="40" height="40" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 21 21"><g fill="none" fill-rule="evenodd" stroke="#fff" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 6.5l-4 4l-4-4"/><path d="M14.5 10.5l-4 4l-4-4"/></g></svg></div>
<div id="buttonUp" class="rectButton" onclick="scrollUp()"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="40" height="40" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 21 21"><g fill="none" fill-rule="evenodd" stroke="#fff" stroke-linecap="round" stroke-linejoin="round"><path d="M6.5 14.5l4-4l4 4"/><path d="M6.5 10.5l4-4l4 4"/></g></svg></div> 

<script>
window.onload = function () {
  var buttons = document.getElementsByClassName("rectButton");
  for (let i=0; i<buttons.length; i++) {
    buttons[i].style.visibility = "visible";
  }
  var buttonDown = document.getElementById("buttonDown");
  buttonDown.classList.add('rectButtonVisible');
  buttonDown.classList.remove('rectButton');

  var buttonUp = document.getElementById("buttonUp");
  buttonUp.classList.add('rectButtonVisible');
  buttonUp.classList.remove('rectButton');
    
  var buttonSizer = document.getElementById("buttonSizer");
  buttonSizer.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="40" height="40" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 21 21"><g fill="none" fill-rule="evenodd" stroke="white" stroke-linecap="round" stroke-linejoin="round"><path d="M9.5 16.5v-4.978l-5-.022"/><path d="M18.5 2.5l-7 7"/><path d="M16.5 9.5l-5 .023V4.5"/><path d="M9.5 11.5l-7 7"/></g></svg>';
  if (document.getElementById("buttonTime") !== null) {
    var buttonTime = document.getElementById("buttonTime");
    buttonTime.style.bottom = "50px";
  }
  document.getElementById("expand").value = "+ Show more results";
  document.getElementById("expand").className += " expand";
  var embarkButton = document.getElementById("embark");
  if ( !(embarkButton.href.includes("embarkBackUrl")) ) {
    embarkButton.classList.remove('hidden');
    document.getElementById("logoImage").src = "./../../style/embark.svg";
    document.getElementById("logo").style.background = "#2d2d2d";
  }
}

function openNav() {
  document.getElementById("sidenav").style.width = "250px";
  document.getElementById("main").style.marginLeft = "250px";
  document.getElementById("nav").style.visibility = "visible";
}

function closeNav() {
  document.getElementById("sidenav").style.width = "50px";
  document.getElementById("sidenav").scrollTop = 0;
  document.getElementById("main").style.marginLeft = "50px";
  document.getElementById("nav").style.visibility = "hidden";
}

function scrollDown() {
  window.scrollTo(0,document.body.scrollHeight);
}

function scrollUp() {
  window.scrollTo(0,0);
}

function buttonNav() {
  var button = document.getElementById("buttonSizer");
  if ( button.classList.contains('buttonOpen') ) {
    button.classList.remove('buttonOpen');
    button.classList.add('buttonClose');
    button.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="40" height="40" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 21 21"><g fill="none" fill-rule="evenodd" stroke="white" stroke-linecap="round" stroke-linejoin="round"><path d="M9.5 16.5v-4.978l-5-.022"/><path d="M18.5 2.5l-7 7"/><path d="M16.5 9.5l-5 .023V4.5"/><path d="M9.5 11.5l-7 7"/></g></svg>';
    openNav();
  } else if( button.classList.contains('buttonClose') ) {
    button.classList.remove('buttonClose');
    button.classList.add('buttonOpen');
    button.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="40" height="40" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 21 21"><g fill="none" fill-rule="evenodd" stroke="white" stroke-linecap="round" stroke-linejoin="round"><path d="M18.5 7.5v-5h-5"/><path d="M18.5 2.5l-6 5.929"/><path d="M7.5 18.5l-5 .023V13.5"/><path d="M8.5 12.5l-6 6"/></g></svg>';
    closeNav();
  };
}

// the following function is currently not used
// it is for future extensions
function overlay_output(link) {
  var rawfile = new XMLHttpRequest();
  rawfile.open('GET', link, false);
  rawfile.overrideMimeType("text");
  rawfile.onreadystatechange = function()
  {
    alert(rawfile.responseText);
    //console.log(rawfile.responseText);
  }
  rawfile.send(null);
}

document.onkeydown = function(e) {
    switch (e.keyCode) {
      case 37:
        document.getElementById("buttonForward").parentNode.click(); 
        break;
      case 39:
        document.getElementById("buttonBack").parentNode.click();       
        break;
    }
};
</script>

</body>
</html>
