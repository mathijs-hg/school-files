<br />
<pre>void vlan_set(int param_1,int param_2)</pre>
<br />
<pre>{</pre>
<pre>  ulong uVar1;</pre>
<pre>  size_t sVar2;</pre>
<pre>  uint uVar3;</pre>
<pre>  uint local_28;</pre>
<pre>  uint local_24;</pre>
<pre>  ulong local_20;</pre>
<pre>  uint local_10 [2];</pre>
<pre>  </pre>
<pre>  local_20 = 0;</pre>
<pre>  if (param_1 &lt; 5) {</pre>
<pre>    puts("insufficient arguments!");</pre>
<pre>  }</pre>
<pre>  else {</pre>
<pre>    uVar1 = strtoul(*(char **)(param_2 + 0x10),(char **)0x0,0);</pre>
<pre>    if (((int)uVar1 &lt; 0) || (0xfff &lt; (int)uVar1)) {</pre>
<pre>      puts("wrong vlan id range, should be within 0~4095");</pre>
<pre>    }</pre>
<pre>    else {</pre>
<pre><span class="green">      sVar2 = strlen(*(char **)(param_2 + 0x14))</span></span></pre>
<pre>      if (sVar2 == 8) {</pre>
<pre>        local_24 = 0;</pre>
<pre>        for (local_28 = 0; local_28 &lt; 8; local_28 = local_28 + 1) {</pre>
<pre>          if ((*(char *)(*(int *)(param_2 + 0x14) + local_28) != '0') &amp;&amp;</pre>
<pre>             (*(char *)(*(int *)(param_2 + 0x14) + local_28) != '1')) {</pre>
<pre>            puts("portmap format error, should be of combination of 0 or 1");</pre>
<pre>            return;</pre>
<pre>          }</pre>
<pre>          local_24 = local_24 +</pre>
<pre>                     (*(char *)(*(int *)(param_2 + 0x14) + local_28) + -0x30 &lt;&lt; (local_28 &amp; 0x1f));</pre>
<pre>        }</pre>
<pre>        if (6 &lt; param_1) {</pre>
<pre>          local_20 = strtoul(*(char **)(param_2 + 0x18),(char **)0x0,0x10);</pre>
<pre>          printf("STAG index is 0x%x\n",local_20);</pre>
<pre>        }</pre>
<pre>        uVar3 = (local_20 &amp; 0xfff) &lt;&lt; 4 | local_24 &lt;&lt; 0x10 | 0x40000000;</pre>
<pre>        local_10[0] = uVar3 | 1;</pre>
<pre>        if (7 &lt; param_1) {</pre>
<pre>          local_10[0] = uVar3 | 0x10000001;</pre>
<pre>        }</pre>
<pre>        if (8 &lt; param_1) {</pre>
<pre>          local_10[0] = local_10[0] | 0x10000000;</pre>
<pre>          reg_write(0x98,0);</pre>
<pre>        }</pre>
<pre>        reg_write(0x94,local_10[0]);</pre>
<pre>        local_10[0] = uVar1 + 0x80001000;</pre>
<pre>        reg_write(0x90,local_10[0]);</pre>
<pre>        for (local_24 = 0; local_24 &lt; 300; local_24 = local_24 + 1) {</pre>
<pre>          usleep(1000);</pre>
<pre><span class="green">          reg_read(0x90,local_10)</span></span></pre>
<pre>          if (-1 &lt; (int)local_10[0]) break;</pre>
<pre>        }</pre>
<pre>        if (local_24 == 300) {</pre>
<pre>          puts("config vlan timeout.");</pre>
<pre>        }</pre>
<pre>      }</pre>
<pre>      else {</pre>
<pre>        puts("portmap format error, should be of length 7");</pre>
<pre>      }</pre>
<pre>    }</pre>
<pre>  }</pre>
<pre>  return;</pre>
<pre>}</pre>
<br />
<pre>[ASK_GPT] 00e18d8cbc27fc18</pre>
