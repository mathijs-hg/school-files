<br />
<pre>int ubi_get_info(libubi_t desc,ubi_info *info)</pre>
<br />
<pre>{</pre>
<pre>  FILE *pFVar1;</pre>
<pre>  int iVar2;</pre>
<pre>  DIR *__dirp;</pre>
<pre>  int *piVar3;</pre>
<pre>  dirent64 *pdVar4;</pre>
<pre>  size_t sVar5;</pre>
<pre>  char *pcVar6;</pre>
<pre>  int dev_num;</pre>
<pre>  char tmp_buf [256];</pre>
<pre>  </pre>
<pre><span class="green">  memset(info,0,0x18)</span></span></pre>
<pre>  iVar2 = read_major(*(char **)((int)desc + 8),&amp;info-&gt;ctrl_major,&amp;info-&gt;ctrl_minor);</pre>
<pre>  if (iVar2 != 0) {</pre>
<pre>    info-&gt;ctrl_minor = -1;</pre>
<pre>    info-&gt;ctrl_major = -1;</pre>
<pre>  }</pre>
<pre>  __dirp = opendir(*(char **)((int)desc + 0xc));</pre>
<pre>  iVar2 = -1;</pre>
<pre>  if (__dirp != (DIR *)0x0) {</pre>
<pre>    info-&gt;lowest_dev_num = 0x7fffffff;</pre>
<pre>    piVar3 = __errno_location();</pre>
<pre>    while( true ) {</pre>
<pre>      *piVar3 = 0;</pre>
<pre>      pdVar4 = readdir64(__dirp);</pre>
<pre>      pcVar6 = pdVar4-&gt;d_name;</pre>
<pre>      if (pdVar4 == (dirent64 *)0x0) break;</pre>
<pre>      sVar5 = strlen(pcVar6);</pre>
<pre>      if (0xfe &lt; sVar5) {</pre>
<pre>        fprintf(stderr,"%s: error!: invalid entry in %s: \"%s\"\n","libubi",</pre>
<pre>                *(undefined4 *)((int)desc + 0xc),pcVar6);</pre>
<pre>        *piVar3 = 0x16;</pre>
<pre>        goto out_close;</pre>
<pre>      }</pre>
<pre><span class="green"><span class="green">      iVar2 = sscanf(pcVar6,"ubi%d%s",&amp;dev_num,tmp_buf)</span></span></span></pre>
<pre>      if (iVar2 == 1) {</pre>
<pre>        info-&gt;dev_count = info-&gt;dev_count + 1;</pre>
<pre>        if (info-&gt;highest_dev_num &lt; dev_num) {</pre>
<pre>          info-&gt;highest_dev_num = dev_num;</pre>
<pre>        }</pre>
<pre>        if (dev_num &lt; info-&gt;lowest_dev_num) {</pre>
<pre>          info-&gt;lowest_dev_num = dev_num;</pre>
<pre>        }</pre>
<pre>      }</pre>
<pre>    }</pre>
<pre>    iVar2 = *piVar3;</pre>
<pre>    if (iVar2 == 0) {</pre>
<pre>      iVar2 = closedir(__dirp);</pre>
<pre>      if (iVar2 == 0) {</pre>
<pre>        if (info-&gt;lowest_dev_num == 0x7fffffff) {</pre>
<pre>          info-&gt;lowest_dev_num = 0;</pre>
<pre>        }</pre>
<pre>        iVar2 = read_positive_int(*(char **)((int)desc + 0x14),&amp;info-&gt;version);</pre>
<pre>        iVar2 = (iVar2 == 0) - 1;</pre>
<pre>      }</pre>
<pre>      else {</pre>
<pre>        iVar2 = *piVar3;</pre>
<pre>        fprintf(stderr,"%s: error!: closedir failed on \"%s\"\n","libubi",</pre>
<pre>                *(undefined4 *)((int)desc + 0xc));</pre>
<pre>        pFVar1 = stderr;</pre>
<pre>        pcVar6 = strerror(iVar2);</pre>
<pre>        fprintf(pFVar1,"%*serror %d (%s)\n",8,&amp;DAT_0040e38c,iVar2,pcVar6);</pre>
<pre>        iVar2 = -1;</pre>
<pre>      }</pre>
<pre>    }</pre>
<pre>    else {</pre>
<pre>      fprintf(stderr,"%s: error!: readdir failed on \"%s\"\n","libubi",</pre>
<pre>              *(undefined4 *)((int)desc + 0xc));</pre>
<pre>      pFVar1 = stderr;</pre>
<pre>      pcVar6 = strerror(iVar2);</pre>
<pre>      fprintf(pFVar1,"%*serror %d (%s)\n",8,&amp;DAT_0040e38c,iVar2,pcVar6);</pre>
<pre>out_close:</pre>
<pre>      closedir(__dirp);</pre>
<pre>      iVar2 = -1;</pre>
<pre>    }</pre>
<pre>  }</pre>
<pre>  return iVar2;</pre>
<pre>}</pre>
<br />
<pre>[ASK_GPT] 6b796bcdbcae8af1</pre>
