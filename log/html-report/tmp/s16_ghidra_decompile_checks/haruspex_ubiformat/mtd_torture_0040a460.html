<br />
<pre>int mtd_torture(libmtd_t desc,mtd_dev_info *mtd,int fd,int eb)</pre>
<br />
<pre>{</pre>
<pre>  byte *buf;</pre>
<pre>  int iVar1;</pre>
<pre>  size_t sVar2;</pre>
<pre>  int *piVar3;</pre>
<pre>  byte *pbVar4;</pre>
<pre>  size_t __n;</pre>
<pre>  uint __c;</pre>
<pre>  uint8_t *puVar5;</pre>
<pre>  </pre>
<pre>  printf("%s: run torture test for PEB %d\n","libmtd",eb);</pre>
<pre><span class="green">  buf = (byte *)xmalloc(mtd-&gt;eb_size)</span></span></pre>
<pre>  puVar5 = patterns;</pre>
<pre>  while( true ) {</pre>
<pre>    iVar1 = mtd_erase(desc,mtd,fd,eb);</pre>
<pre><span class="green">    if ((iVar1 != 0) || (iVar1 = mtd_read(mtd,fd,eb,0,buf,mtd-&gt;eb_size), iVar1 != 0)) goto out</span></span></pre>
<pre>    __n = mtd-&gt;eb_size;</pre>
<pre>    if (0 &lt; (int)__n) break;</pre>
<pre>LAB_0040a564:</pre>
<pre>    __c = (uint)*puVar5;</pre>
<pre>    memset(buf,__c,__n);</pre>
<pre>    iVar1 = mtd_write(desc,mtd,fd,eb,0,buf,mtd-&gt;eb_size,(void *)0x0,0,'\0');</pre>
<pre>    if (iVar1 != 0) goto out;</pre>
<pre>    memset(buf,~__c,mtd-&gt;eb_size);</pre>
<pre><span class="green">    iVar1 = mtd_read(mtd,fd,eb,0,buf,mtd-&gt;eb_size)</span></span></pre>
<pre>    if (iVar1 != 0) goto out;</pre>
<pre>    if (0 &lt; mtd-&gt;eb_size) {</pre>
<pre>      if (*buf != __c) {</pre>
<pre>LAB_0040a6ec:</pre>
<pre>        fprintf(stderr,"%s: error!: pattern %x checking failed for PEB %d\n","libmtd",__c,eb);</pre>
<pre>        goto code_r0x0040a6cc;</pre>
<pre>      }</pre>
<pre>      iVar1 = 1;</pre>
<pre>      while (pbVar4 = buf + iVar1, iVar1 != mtd-&gt;eb_size) {</pre>
<pre>        iVar1 = iVar1 + 1;</pre>
<pre>        if (*pbVar4 != __c) goto LAB_0040a6ec;</pre>
<pre>      }</pre>
<pre>    }</pre>
<pre>    puVar5 = puVar5 + 1;</pre>
<pre>    if (puVar5 == &amp;UNK_00410817) {</pre>
<pre>      printf("%s: PEB %d passed torture test, do not mark it a bad\n","libmtd",eb);</pre>
<pre>out:</pre>
<pre>      free(buf);</pre>
<pre>      return -1;</pre>
<pre>    }</pre>
<pre>  }</pre>
<pre>  if (*buf == 0xff) {</pre>
<pre><span class="green">    sVar2 = 1</span></span></pre>
<pre>    while (pbVar4 = buf + sVar2, sVar2 != __n) {</pre>
<pre><span class="green">      sVar2 = sVar2 + 1</span></span></pre>
<pre>      if (*pbVar4 != 0xff) goto LAB_0040a6a4;</pre>
<pre>    }</pre>
<pre>    goto LAB_0040a564;</pre>
<pre>  }</pre>
<pre>LAB_0040a6a4:</pre>
<pre>  fprintf(stderr,"%s: error!: erased PEB %d, but a non-0xFF byte found\n","libmtd",eb);</pre>
<pre>code_r0x0040a6cc:</pre>
<pre>  piVar3 = __errno_location();</pre>
<pre>  *piVar3 = 5;</pre>
<pre>  goto out;</pre>
<pre>}</pre>
<br />
<pre>[ASK_GPT] be8e9b1b9103e749</pre>
