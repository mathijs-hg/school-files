!function(o){o.su.moduleManager.define("mapClients",{services:["ajax"],deps:["networkMap","navigatorController"],stores:["connectedClientsStore","mapClientDecoList"],views:["mapClientsView"],listeners:{"ev_on_launch":function(e,n,t,i,a,s,c){this.unRegisterAutoSaveData([a.connectedClientsStore]),this.setClientComboValue("default"),n.getClients()}},init:function(a,s,e,t,c,n){this.configViews({id:"mapClientsView",items:[{id:"connected-clients-grid",configs:{columns:[{dataIndex:"deviceName",cls:"m-hide l-hide xl-hide label-empty",renderer:function(e,n){if("object"===o.type(n))return o.su.escapeHtml(o.su.b64Decode(n.deviceName))}},{dataIndex:"deviceType",cls:"m-hide l-hide xl-hide label-empty",renderer:function(e,n){var t="",i="";switch(e=e.toLowerCase()){case"pc":t="icon-pc";break;case"phone":t="icon-phone";break;case"tablet":t="icon-pad";break;case"other":t="icon-pc";break;default:t="icon-"+e}return i+='<div class="device-type-container widget-container">',i+='<span class="icon '+t+' "></span>',null!=n.enableInternet&&(i+='<span class="text">'+(n.enableInternet?"":o.su.CHAR.NETWORK_MAP.INTERNET_PAUSED)+"</span>"),i+="</div>",i+='<div class="device-info-container widget-container">',i+='<div class="mac">'+n.mac+"</div>",i+='<div class="ip">'+("0.0.0.0"===n.ip||null===n.ip?"-":n.ip)+"</div>",i+="</div>"}},{text:o.su.CHAR.MAP_CLIENT.TYPE,width:110,dataIndex:"deviceType",cls:"s-hide",renderer:function(e,n){var t="",i="";switch(e=e.toLowerCase()){case"pc":t="icon-pc";break;case"phone":t="icon-phone";break;case"tablet":t="icon-pad";break;case"other":t="icon-pc";break;default:t="icon-"+e}return i+='<div class="device-type-container widget-container">',i+='<span class="icon '+t+' "></span>',i+="</div>"}},{text:o.su.CHAR.MAP_CLIENT.INFORMATION,dataIndex:"deviceName",cls:"s-hide",renderer:function(e,n){var t="";if("object"===o.type(n)){var i=o.su.escapeHtml(o.su.b64Decode(n.deviceName));t+='<div class="device-info-container widget-container">',t+='<div class="name" title="'+i+'">'+i+"</div>",t+='<div class="mac">'+n.mac+"</div>",t+='<div class="ip">'+("0.0.0.0"===n.ip||null===n.ip?"-":n.ip)+"</div>",t+="</div>"}return t}},{text:o.su.CHAR.MAP_CLIENT.REAL_TIME_RATE,dataIndex:"downloadSpeed",renderer:function(e,n){var t,i,a="",s=function(e){var n;return n=(e=parseInt(e,10))/1024<1?o.su.CHAR.MAP_CLIENT.KBPS:(e=(e/1024).toFixed(1),o.su.CHAR.MAP_CLIENT.MBPS),{speed:e,unit:n}};return"object"===o.type(n)&&(t=s(n.downloadSpeed),a+='<div class="speed-upload-container widget-container">',a+='<span class="icon"></span>',a+='<span class="text">'+(i=s(n.uploadSpeed)).speed+"</span>",a+='<span class="unit">'+i.unit+"</span>",a+="</div>",a+='<div class="speed-download-container widget-container">',a+='<span class="icon"></span>',a+='<span class="text">'+t.speed+"</span>",a+='<span class="unit">'+t.unit+"</span>",a+="</div>"),a}},{text:o.su.CHAR.MAP_CLIENT.CONNECTION_DURATION,dataIndex:"connectionType",renderer:function(e){switch(e){case"band2_4":return o.su.CHAR.MAP_CLIENT.WIRELESS_24G;case"band5":case"band5_2":return o.su.CHAR.MAP_CLIENT.WIRELESS_5G;case"band6":return o.su.CHAR.MAP_CLIENT.WIRELESS_6G;case"wired":return o.su.CHAR.MAP_CLIENT.WIRED;case"zigbee":return o.su.CHAR.MAP_CLIENT.ZIGBEE;case"bluetooth":return o.su.CHAR.MAP_CLIENT.BLUETOOTH;default:return"-"}}}]}}]}),this.control({}),this.listen({"stores.connectedClientsStore":{"ev_loaded":function(){var e=t.connectedClientsStore.getData();o.each(e,function(e,n){!1===n.online&&t.connectedClientsStore.disable(n.key)})}},"views.mapClientsView.mapClientCombo":{"ev_value_change":function(e,n,t){var i=s.mapClientsView.mapClientCombo.getValue();c.networkMap.currentDeco=i,a.getClients(i)}}})}},function(e,n,t,i,a,s){var c,o,r=null;return{getClients:function(e){var n={success:function(e){a.networkMap.trigger("ev_clients_number_changed",e.client_list.length),e=i.connectedClientsStore.getData(),r=setTimeout(t,1e4)},fail:function(){r=setTimeout(t,1e4)},error:function(){r=setTimeout(t,1e4)}};function t(){c[n.requestID]&&(e&&(n.data={device_mac:e}),i.connectedClientsStore.load(n))}c={},clearTimeout(r),o=setTimeout(t,0),n.requestID=o,c[o]=!0},setClientComboValue:function(e){n.mapClientsView.mapClientCombo.setValue(e)},beforeDestroy:function(){clearTimeout(r)}}})}(jQuery);