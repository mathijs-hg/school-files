!function(t){t.su.moduleManager.define("firmwareIsp",{views:["firmwareIspView"],models:["firmwareTypeIspM"],services:["ajax","vtype","language","device"],deps:["main"],listeners:{"ev_on_launch":function(e,r,a,i,s,n,t){i.firmwareTypeIspM.load()}},init:function(r,s,e,a,i,n){this.listen({}),this.control({"#manual-upgrade-file":{"ev_file_change":function(){var e=s.firmwareIspView.firmwareFile,r=e.getFileName(),a=e.getFileSize(),i=this.checkFileName(r,"zip");""===r?e.setNormal():!0!==i?e.setError(i):10<a?e.setError(t.su.CHAR.ERROR["00000002"]):e.setNormal()}},"#local-upgrade-btn":{"ev_button_click":function(){var e=s.firmwareIspView.firmwareFile;e.getContainer().hasClass("error")||e.isEmpty()||r.startLocalUpgrade()}}})}},function(e,r,a,i,s,n){return{startLocalUpgrade:function(){r.firmwareIspView.proBar.reset(),r.firmwareIspView.progressbarWrap.show(),r.firmwareIspView.proBar.animate({duration:1e4,percentageStart:0,percentageEnd:100,callback:function(){r.firmwareIspView.progressbarWrap.hide()}}),n.ajax.upload({proxy:"uploadFirmwareIspProxy",fileId:"manual-upgrade-file",timeout:1e4,preventSuccessEvent:!0,success:function(e){switch(r.firmwareIspView.progressbarWrap.hide(),e.upgrade_result){case"success":s.main.alert(t.su.CHAR.FIRMWARE.UPGRADE_SUCCESS),a.firmwareTypeIspM.load();break;case"error_isp_newest":s.main.showError(t.su.CHAR.FIRMWARE.FIRMWARE_NEWEST);break;case"error_isp_up":s.main.showError(t.su.CHAR.FIRMWARE.UPGRADE_FAIL)}},fail:function(){r.firmwareIspView.progressbarWrap.hide(),s.main.showError(t.su.CHAR.FIRMWARE.UPGRADE_FAIL)},error:function(){r.firmwareIspView.progressbarWrap.hide(),s.main.showError(t.su.CHAR.FIRMWARE.UPGRADE_FAIL)}})},checkFileName:function(e,r){return n.vtype.validate(e,{vtype:"string_file",extension:r})}}})}(jQuery);