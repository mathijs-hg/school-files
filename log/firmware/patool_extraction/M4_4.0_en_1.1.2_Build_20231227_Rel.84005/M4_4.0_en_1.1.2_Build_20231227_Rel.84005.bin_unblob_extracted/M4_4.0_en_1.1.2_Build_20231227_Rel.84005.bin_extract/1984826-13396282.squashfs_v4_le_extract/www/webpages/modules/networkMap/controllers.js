!function(k){k.su.moduleManager.define("networkMap",{services:["moduleLoader","ajax","device"],models:["wirelessInfoModel"],stores:["mapClientDecoList"],deps:["mapInternet"],views:["networkMapView"],listeners:{"ev_on_launch":function(e,t,n,o,r,i,a){t.switchModule("router"),t.loadModules(function(){t.startGetInternetStatus()})},"ev_before_destroy":function(e,t){t.beforeDestroy()},"ev_clients_number_changed":function(e,t){this.setClientsNumber(t)},"ev_deco_number_changed":function(e,t){this.setDecoNumber(t)}},init:function(t,e,n,o,r,i){this.configViews({}),this.control({"#map-internet":{"click":function(e){t.switchModule("internet")}},"#map-router":{"click":function(e){t.switchModule("router")}},"#map-clients":{"click":function(e){t.switchModule("clients")}}}),this.listen({})}},function(_,i,t,a,h,r){var g,C=null,L=(r.device.getCurrentMode(),"internet"),D=!0;return{currentDeco:"default",loadModules:function(e){var t=k.Deferred(),n=k.Deferred(),o=k.Deferred();r.moduleLoader.load({module:"networkMap"},{module:"mapInternet"},i.networkMapView.mapInternetLoader,function(){t.resolve()}),r.moduleLoader.load({module:"networkMap"},{module:"mapRouter"},i.networkMapView.mapRouterLoader,function(){n.resolve()}),r.moduleLoader.load({module:"networkMap"},{module:"mapClients"},i.networkMapView.mapClientsLoader,function(){o.resolve()}),k.when(t,n,o).then(function(){e&&e()})},switchModule:function(e){for(var t=["internet","router","clients"],n=0;n<t.length;n++){var o="map"+(t[n].charAt(0).toUpperCase()+t[n].slice(1))+"Loader",r="#map-"+t[n];t[n]===e?(k(r).addClass("active"),i.networkMapView[o].show()):(k(r).removeClass("active"),i.networkMapView[o].hide())}L=e},startGetInternetStatus:function(){var v=r.device.getCurrentMode(),w="LTE"===v.sysMode||"Mobile_5G"===v.sysMode,t=function(e){var t,n,o,r,i,a=e.device_list,s=!1,u=!0;g=e;for(var l=0,c=a.length;l<c;l++){var d=(t=a[l]).group_status.toLowerCase(),m=t.inet_status.toLowerCase(),f=t.inet_error_msg.toLowerCase();"offline"===m&&"well"!==f||(s=!0),t.online=!0,("disconnected"===d||"online"!==m&&"well"!==f)&&(u=!1,t.online=!1),"master"===t.role&&(n=t.nickname,o=t.device_model,i=t.imei)}if("router"===L&&(r=k.su.moduleManager.get("mapRouter"),"RE"!==v.workMode&&r.initDecoTree(g),D&&g&&(r.updateDevicePanel(o),r.updateDeviceName(n),w&&r.updateDeviceIMEI(i)),D=!1),u?_.trigger("ev_deco_number_changed",a.length):_.trigger("ev_deco_number_changed",null),k("#map-internet .map-internet-icon-status").toggleClass("disconnected",!s),k("#map-router .map-router-icon-num").toggleClass("disconnected",!u),w){var p=a[0]&&a[0].inet_error_msg;h.mapInternet.setInternetStatus(s,p)}else h.mapInternet.setInternetStatus(s);_.setClientsDecoList(k.su.filterArrField.call(a,"mac","nickname","online")),C=setTimeout(M,1e4)},n=function(){C=setTimeout(M,1e4)},o=function(e){"abort"!==e.statusText&&(C=setTimeout(M,1e4))};function M(){var e=r.ajax.request({proxy:"getFirmwareListProxy",success:t,fail:n,error:o});k.when(e).then(function(e){_.xmlHttpRequest=e})}M()},filterArrField:function(){Array.prototype.slice.call(arguments)},setProductName:function(){var e=t.wirelessInfoModel.ssid2_4.getValue()||k.su.CHAR.NETWORK_MAP.ROUTER;i.networkMapView.mapRouter.setField("productName",e)},setClientsNumber:function(e){e=parseInt(e,10),k("#map-clients .map-clients-icon-num").text(isNaN(e)?0:e)},setDecoNumber:function(e){e=parseInt(e,10),k("#map-router .map-router-icon-num").text(isNaN(e)?"":e)},setClientsDecoList:function(e){for(var t=[],n=this.currentDeco,o=0,r=e.length;o<r;o++)if(e[o].online){var i={};i.name=e[o].nickname,i.value=e[o].mac,n===i.value&&(i.selected=!0),t.push(i)}t.unshift("default"===n?{name:k.su.CHAR.MAP_CLIENT.ALL_DECO,value:"default",selected:!0}:{name:k.su.CHAR.MAP_CLIENT.ALL_DECO,value:"default"}),a.mapClientDecoList.loadData(t)},beforeDestroy:function(){clearTimeout(C),_.xmlHttpRequest&&_.xmlHttpRequest.abort()}}})}(jQuery);